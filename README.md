## Node.js

Googleが開発したV8エンジン上で実行する環境のjavascript

サーバーサイドjavascriptには「CommonJS」と呼ばれる標準化が策定されている。
-> サーバーサイドでjavascriptを実行するために何が必要かを仕様として定義しているドキュメント

- しかし、Node.jsはCommonJSのごく一部（moduleとassert）を実装しているだけ


### ECMAScript
javascriptの言語仕様。

- ECMAScriptには、スレッドやI/Oに関しては記述されていない


### 特徴

- 「シングルスレッド」ベースの「非同期処理」環境
- 「シングルスレッド」で非同期処理を実現するために「イベントループ」というアーキテクチャを採用
- 「シングルスレッド」で複数クライアントからのリクエストに対応するために「ノンブロッキングI/O」を使用している

#### ノンブロッキングI/O

データの送受信（I/O）が完了を待たずに、他の処理を開始する処理方式

- 非同期で処理が並列に実行されるため、ある処理の完了を待って、次の処理を行いたい場合は、「コールバック」を使用する

デメリット
- 処理を必ずノンブロッキングで行わないと行けない。

-> どこかでブロックしてしまった場合は、「イベントループ」全体の処理が止まる


#### Node.jsのWebアプリ開発に役立つパッケージ7

- Socket.IO

WebSocketのNode.js実装。リアルタイム通信を作成するのに使用。

- Express

Ruby on Railsライクなフレームワーク。しかし、実際はSinatoraに近いらしい。
MVCの自動生成、ルーティング機能、モデル機能などがある。

- EJS

Node.jsパッケージの中で人気があるテンプレートエンジン。

- Jsdom

HTMLに対して、DOM操作が使える。

- node-validator

バリデーションや文字列操作、サニタイズ処理を行う

- node-oauth

OAuth認証を行う

- node-mysql

データベースのMySQLへ接続する



## イベントループ

- 1. イベントループにイベントハンドラとコールバックを登録
- 2. 実行する処理はイベントキューに格納される
- 3. イベントループを回しながら、キューの中にあるイベントハンドラが実行されていく
- 4. ノンブロッキングI/Oにより、3のイベント(処理)の完了を待たずに、イベントループを回して次のイベントを実行する

3のイベントハンドラの完了結果は、コールバック関数を登録することで受け取る。
3のイベントハンドラで、処理をブロックしてしまった場合、4のイベントまでいかずに、3のブロックが解除されるまで待たなければならない。

- Node.jsでは、イベントを生成して処理を制御する

#### イベントが生成されるタイミングの主な例

-> HTTP ServerがClientからRequestを受け取った時

-> ファイルの読み込みが完了した時


### 参考元
- [naveでNode.jsのバージョン管理＆イベントループ詳説 (2/3)](http://www.atmarkit.co.jp/ait/articles/1103/23/news101_2.html)

